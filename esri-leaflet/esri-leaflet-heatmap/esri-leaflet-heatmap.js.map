{"version":3,"file":"esri-leaflet-heatmap.js","sources":["../package.json","../src/HeatmapFeatureLayer.js"],"sourcesContent":["{\r\n  \"name\": \"esri-leaflet-heatmap\",\r\n  \"description\": \"Esri Leaflet plugin for visualizing Feature Layers as heatmaps with L.heat.\",\r\n  \"version\": \"2.0.0\",\r\n  \"author\": \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\r\n  \"contributors\": [\r\n    \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\r\n    \"John Gravois <jgravois@esri.com> (http://johngravois.com)\"\r\n  ],\r\n  \"dependencies\": {\r\n    \"esri-leaflet\": \"^2.0.0\",\r\n    \"leaflet\": \"^1.0.0-rc.3\",\r\n    \"leaflet.heat\": \"^0.2.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"chai\": \"2.3.0\",\r\n    \"gh-release\": \"^2.0.0\",\r\n    \"http-server\": \"^0.9.0\",\r\n    \"isparta\": \"^3.0.3\",\r\n    \"istanbul\": \"^0.4.2\",\r\n    \"karma\": \"^0.12.24\",\r\n    \"karma-chai-sinon\": \"^0.1.3\",\r\n    \"karma-coverage\": \"^0.5.3\",\r\n    \"karma-mocha\": \"^0.1.0\",\r\n    \"karma-mocha-reporter\": \"^0.2.5\",\r\n    \"karma-phantomjs-launcher\": \"^0.1.4\",\r\n    \"karma-sourcemap-loader\": \"^0.3.5\",\r\n    \"mkdirp\": \"^0.5.1\",\r\n    \"node-sass\": \"^3.2.0\",\r\n    \"phantomjs\": \"^1.9.17\",\r\n    \"rollup\": \"^0.25.4\",\r\n    \"rollup-plugin-json\": \"^2.0.0\",\r\n    \"rollup-plugin-node-resolve\": \"^1.4.0\",\r\n    \"rollup-plugin-uglify\": \"^0.3.1\",\r\n    \"semistandard\": \"^7.0.2\",\r\n    \"sinon\": \"^1.11.1\",\r\n    \"sinon-chai\": \"2.7.0\",\r\n    \"snazzy\": \"^2.0.1\",\r\n    \"watch\": \"^0.17.1\"\r\n  },\r\n  \"homepage\": \"https://github.com/Esri/esri-leaflet-heatmap\",\r\n  \"jsnext:main\": \"src/HeatmapFeatureLayer.js\",\r\n  \"jspm\": {\r\n    \"registry\": \"npm\",\r\n    \"format\": \"es6\",\r\n    \"main\": \"src/HeatmapFeatureLayer.js\"\r\n  },\r\n  \"license\": \"Apache-2.0\",\r\n  \"main\": \"dist/esri-leaflet-heatmap-debug.js\",\r\n  \"readmeFilename\": \"README.md\",\r\n  \"repository\": {\r\n    \"type\": \"git\",\r\n    \"url\": \"git+https://github.com:Esri/esri-leaflet-heatmap.git\"\r\n  },\r\n  \"scripts\": {\r\n    \"prebuild\": \"mkdirp dist\",\r\n    \"build\": \"rollup -c profiles/debug.js & rollup -c profiles/production.js\",\r\n    \"lint\": \"semistandard src/*.js && semistandard spec/*.js | snazzy\",\r\n    \"prepublish\": \"npm run build\",\r\n    \"pretest\": \"npm run build\",\r\n    \"release\": \"node ./scripts/release.sh\",\r\n    \"start\": \"watch 'npm run build' src & http-server -p 6789 -c-1 -o\",\r\n    \"test\": \"npm run lint && karma start\"\r\n  }\r\n}\r\n","export { version as VERSION } from '../package.json';\r\n\r\nimport L from 'leaflet';\r\nimport { FeatureManager } from 'esri-leaflet';\r\n\r\nexport var FeatureLayer = FeatureManager.extend({\r\n  /**\r\n   * Constructor\r\n   */\r\n\r\n  initialize: function (options) {\r\n    FeatureManager.prototype.initialize.call(this, options);\r\n\r\n    options = L.setOptions(this, options);\r\n\r\n    this._cache = {};\r\n    this._active = {};\r\n\r\n    this.heat = window.L.heatLayer([], options);\r\n  },\r\n\r\n  /**\r\n   * Layer Interface\r\n   */\r\n\r\n  onAdd: function (map) {\r\n    FeatureManager.prototype.onAdd.call(this, map);\r\n    this._map.addLayer(this.heat);\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    FeatureManager.prototype.onRemove.call(this, map);\r\n    this._map.removeLayer(this.heat);\r\n  },\r\n\r\n  /**\r\n   * Feature Managment Methods\r\n   */\r\n\r\n  createLayers: function (features) {\r\n    for (var i = features.length - 1; i >= 0; i--) {\r\n      var geojson = features[i];\r\n      var id = geojson.id;\r\n      var latlng = new L.LatLng(geojson.geometry.coordinates[1], geojson.geometry.coordinates[0]);\r\n      this._cache[id] = latlng;\r\n\r\n      // add the layer if it is within the time bounds or our layer is not time enabled\r\n      if (!this._active[id] && (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson)))) {\r\n        this._active[id] = latlng;\r\n        this.heat._latlngs.push(latlng);\r\n      }\r\n    }\r\n\r\n    this.heat.redraw();\r\n  },\r\n\r\n  addLayers: function (ids) {\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var id = ids[i];\r\n      if (!this._active[id]) {\r\n        var latlng = this._cache[id];\r\n        this.heat._latlngs.push(latlng);\r\n        this._active[id] = latlng;\r\n      }\r\n    }\r\n    this.heat.redraw();\r\n  },\r\n\r\n  removeLayers: function (ids, permanent) {\r\n    var newLatLngs = [];\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var id = ids[i];\r\n      if (this._active[id]) {\r\n        delete this._active[id];\r\n      }\r\n      if (this._cache[id] && permanent) {\r\n        delete this._cache[id];\r\n      }\r\n    }\r\n\r\n    for (var latlng in this._active) {\r\n      newLatLngs.push(this._active[latlng]);\r\n    }\r\n\r\n    this.heat.setLatLngs(newLatLngs);\r\n  },\r\n\r\n  setOptions: function (options) {\r\n    this.heat.setOptions(options);\r\n  },\r\n\r\n  redraw: function () {\r\n    this.heat.redraw();\r\n  }\r\n\r\n});\r\n\r\nexport function featureLayer (options) {\r\n  return new FeatureLayer(options);\r\n}\r\n\r\nexport default featureLayer;\r\n"],"names":["featureLayer","options","FeatureLayer","FeatureManager","extend","initialize","prototype","call","this","L","setOptions","_cache","_active","heat","window","heatLayer","onAdd","map","_map","addLayer","onRemove","removeLayer","createLayers","features","i","length","geojson","id","latlng","LatLng","geometry","coordinates","timeField","_featureWithinTimeRange","_latlngs","push","redraw","addLayers","ids","removeLayers","permanent","newLatLngs","setLatLngs"],"mappings":";;;qUCiGO,SAASA,GAAcC,GAC5B,MAAO,IAAIC,GAAaD,kCA7FfC,GAAeC,iBAAeC,QAKvCC,WAAY,SAAUJ,GACpBE,iBAAeG,UAAUD,WAAWE,KAAKC,KAAMP,GAE/CA,EAAUQ,EAAEC,WAAWF,KAAMP,GAE7BO,KAAKG,UACLH,KAAKI,WAELJ,KAAKK,KAAOC,OAAOL,EAAEM,aAAcd,IAOrCe,MAAO,SAAUC,GACfd,iBAAeG,UAAUU,MAAMT,KAAKC,KAAMS,GAC1CT,KAAKU,KAAKC,SAASX,KAAKK,OAG1BO,SAAU,SAAUH,GAClBd,iBAAeG,UAAUc,SAASb,KAAKC,KAAMS,GAC7CT,KAAKU,KAAKG,YAAYb,KAAKK,OAO7BS,aAAc,SAAUC,GACtB,IAAK,GAAIC,GAAID,EAASE,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAC7C,GAAIE,GAAUH,EAASC,GACnBG,EAAKD,EAAQC,GACbC,EAAS,GAAInB,GAAEoB,OAAOH,EAAQI,SAASC,YAAY,GAAIL,EAAQI,SAASC,YAAY,GACxFvB,MAAKG,OAAOgB,GAAMC,GAGbpB,KAAKI,QAAQe,MAASnB,KAAKP,QAAQ+B,WAAcxB,KAAKP,QAAQ+B,WAAaxB,KAAKyB,wBAAwBP,MAC3GlB,KAAKI,QAAQe,GAAMC,EACnBpB,KAAKK,KAAKqB,SAASC,KAAKP,IAI5BpB,KAAKK,KAAKuB,UAGZC,UAAW,SAAUC,GACnB,IAAK,GAAId,GAAIc,EAAIb,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACxC,GAAIG,GAAKW,EAAId,EACb,KAAKhB,KAAKI,QAAQe,GAAK,CACrB,GAAIC,GAASpB,KAAKG,OAAOgB,EACzBnB,MAAKK,KAAKqB,SAASC,KAAKP,GACxBpB,KAAKI,QAAQe,GAAMC,GAGvBpB,KAAKK,KAAKuB,UAGZG,aAAc,SAAUD,EAAKE,GAE3B,IAAK,GADDC,MACKjB,EAAIc,EAAIb,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACxC,GAAIG,GAAKW,EAAId,EACThB,MAAKI,QAAQe,UACRnB,MAAKI,QAAQe,GAElBnB,KAAKG,OAAOgB,IAAOa,SACdhC,MAAKG,OAAOgB,GAIvB,IAAK,GAAIC,KAAUpB,MAAKI,QACtB6B,EAAWN,KAAK3B,KAAKI,QAAQgB,GAG/BpB,MAAKK,KAAK6B,WAAWD,IAGvB/B,WAAY,SAAUT,GACpBO,KAAKK,KAAKH,WAAWT,IAGvBmC,OAAQ,WACN5B,KAAKK,KAAKuB"}