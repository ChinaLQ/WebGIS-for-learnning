{"version":3,"file":"esri-leaflet-cluster.js","sources":["../package.json","../src/ClusterFeatureLayer.js"],"sourcesContent":["{\r\n  \"name\": \"esri-leaflet-cluster\",\r\n  \"description\": \"Esri Leaflet plugin for visualizing Feature Layers as clusters with L.markercluster.\",\r\n  \"version\": \"2.0.0\",\r\n  \"author\": \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\r\n  \"contributors\": [\r\n    \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\r\n    \"John Gravois <jgravois@esri.com> (http://johngravois.com)\"\r\n  ],\r\n  \"dependencies\": {\r\n    \"esri-leaflet\": \"^2.0.0\",\r\n    \"leaflet\": \"^1.0.0\",\r\n    \"leaflet.markercluster\": \"^1.0.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"chai\": \"2.3.0\",\r\n    \"gh-release\": \"^2.0.0\",\r\n    \"http-server\": \"^0.8.5\",\r\n    \"isparta\": \"^3.0.3\",\r\n    \"istanbul\": \"^0.4.2\",\r\n    \"karma\": \"^0.12.24\",\r\n    \"karma-chai-sinon\": \"^0.1.3\",\r\n    \"karma-coverage\": \"^0.5.3\",\r\n    \"karma-mocha\": \"^0.1.0\",\r\n    \"karma-mocha-reporter\": \"^0.2.5\",\r\n    \"karma-phantomjs-launcher\": \"^0.1.4\",\r\n    \"karma-sourcemap-loader\": \"^0.3.5\",\r\n    \"mkdirp\": \"^0.5.1\",\r\n    \"mocha\": \"^3.4.2\",\r\n    \"node-sass\": \"^3.2.0\",\r\n    \"phantomjs\": \"^1.9.17\",\r\n    \"rollup\": \"^0.25.4\",\r\n    \"rollup-plugin-json\": \"^2.0.0\",\r\n    \"rollup-plugin-node-resolve\": \"^1.4.0\",\r\n    \"rollup-plugin-uglify\": \"^0.3.1\",\r\n    \"semistandard\": \"^7.0.4\",\r\n    \"sinon\": \"^1.11.1\",\r\n    \"sinon-chai\": \"2.7.0\",\r\n    \"snazzy\": \"^2.0.1\",\r\n    \"watch\": \"^0.17.1\"\r\n  },\r\n  \"homepage\": \"https://github.com/Esri/esri-leaflet-cluster\",\r\n  \"jsnext:main\": \"src/ClusterFeatureLayer.js\",\r\n  \"jspm\": {\r\n    \"registry\": \"npm\",\r\n    \"format\": \"es6\",\r\n    \"main\": \"src/ClusterFeatureLayer.js\"\r\n  },\r\n  \"keywords\": [\r\n    \"arcgis\",\r\n    \"esri\",\r\n    \"esri leaflet\",\r\n    \"gis\",\r\n    \"leaflet plugin\",\r\n    \"mapping\"\r\n  ],\r\n  \"license\": \"Apache-2.0\",\r\n  \"main\": \"dist/esri-leaflet-cluster-debug.js\",\r\n  \"module\": \"src/ClusterFeatureLayer.js\",\r\n  \"readmeFilename\": \"README.md\",\r\n  \"repository\": {\r\n    \"type\": \"git\",\r\n    \"url\": \"git+https://github.com/Esri/esri-leaflet-cluster.git\"\r\n  },\r\n  \"scripts\": {\r\n    \"prebuild\": \"mkdirp dist\",\r\n    \"build\": \"rollup -c profiles/debug.js & rollup -c profiles/production.js\",\r\n    \"lint\": \"semistandard | snazzy\",\r\n    \"prepublish\": \"npm run build\",\r\n    \"pretest\": \"npm run build\",\r\n    \"release\": \"./scripts/release.sh\",\r\n    \"start\": \"watch 'npm run build' src & http-server -p 5678 -c-1 -o\",\r\n    \"test\": \"npm run lint && karma start\"\r\n  },\r\n  \"semistandard\": {\r\n    \"globals\": [\r\n      \"expect\",\r\n      \"L\",\r\n      \"sinon\"\r\n    ]\r\n  }\r\n}\r\n","export { version as VERSION } from '../package.json';\r\n\r\nimport L from 'leaflet';\r\nimport { FeatureManager } from 'esri-leaflet';\r\n\r\nexport var FeatureLayer = FeatureManager.extend({\r\n\r\n  statics: {\r\n    EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose',\r\n    CLUSTEREVENTS: 'clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu'\r\n  },\r\n\r\n  /**\r\n   * Constructor\r\n   */\r\n\r\n  initialize: function (options) {\r\n    FeatureManager.prototype.initialize.call(this, options);\r\n\r\n    options = L.setOptions(this, options);\r\n\r\n    this._layers = {};\r\n    this._leafletIds = {};\r\n\r\n    this.cluster = L.markerClusterGroup(options);\r\n    this._key = 'c' + (Math.random() * 1e9).toString(36).replace('.', '_');\r\n\r\n    this.cluster.addEventParent(this);\r\n  },\r\n\r\n  /**\r\n   * Layer Interface\r\n   */\r\n\r\n  onAdd: function (map) {\r\n    FeatureManager.prototype.onAdd.call(this, map);\r\n    this._map.addLayer(this.cluster);\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    FeatureManager.prototype.onRemove.call(this, map);\r\n    this._map.removeLayer(this.cluster);\r\n  },\r\n\r\n  /**\r\n   * Feature Management Methods\r\n   */\r\n\r\n  createLayers: function (features) {\r\n    var markers = [];\r\n\r\n    for (var i = features.length - 1; i >= 0; i--) {\r\n      var geojson = features[i];\r\n      var layer = this._layers[geojson.id];\r\n\r\n      if (!layer) {\r\n        layer = L.GeoJSON.geometryToLayer(geojson, this.options);\r\n        layer.feature = L.GeoJSON.asFeature(geojson);\r\n        layer.defaultOptions = layer.options;\r\n        layer._leaflet_id = this._key + '_' + geojson.id;\r\n\r\n        this.resetStyle(layer.feature.id);\r\n\r\n        // cache the layer\r\n        this._layers[layer.feature.id] = layer;\r\n\r\n        this._leafletIds[layer._leaflet_id] = geojson.id;\r\n\r\n        if (this.options.onEachFeature) {\r\n          this.options.onEachFeature(layer.feature, layer);\r\n        }\r\n\r\n        this.fire('createfeature', {\r\n          feature: layer.feature\r\n        });\r\n      }\r\n\r\n      // add the layer if it is within the time bounds or our layer is not time enabled\r\n      if (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson))) {\r\n        markers.push(layer);\r\n      }\r\n    }\r\n\r\n    if (markers.length) {\r\n      this.cluster.addLayers(markers);\r\n    }\r\n  },\r\n\r\n  addLayers: function (ids) {\r\n    var layersToAdd = [];\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var layer = this._layers[ids[i]];\r\n      this.fire('addfeature', {\r\n        feature: layer.feature\r\n      });\r\n      layersToAdd.push(layer);\r\n    }\r\n    this.cluster.addLayers(layersToAdd);\r\n  },\r\n\r\n  removeLayers: function (ids, permanent) {\r\n    var layersToRemove = [];\r\n    for (var i = ids.length - 1; i >= 0; i--) {\r\n      var id = ids[i];\r\n      var layer = this._layers[id];\r\n      this.fire('removefeature', {\r\n        feature: layer.feature,\r\n        permanent: permanent\r\n      });\r\n      layersToRemove.push(layer);\r\n      if (this._layers[id] && permanent) {\r\n        delete this._layers[id];\r\n      }\r\n    }\r\n    this.cluster.removeLayers(layersToRemove);\r\n  },\r\n\r\n  /**\r\n   * Styling Methods\r\n   */\r\n\r\n  resetStyle: function (id) {\r\n    var layer = this._layers[id];\r\n\r\n    if (layer) {\r\n      layer.options = layer.defaultOptions;\r\n      this.setFeatureStyle(layer.feature.id, this.options.style);\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  setStyle: function (style) {\r\n    this.eachFeature(function (layer) {\r\n      this.setFeatureStyle(layer.feature.id, style);\r\n    }, this);\r\n    return this;\r\n  },\r\n\r\n  setFeatureStyle: function (id, style) {\r\n    var layer = this._layers[id];\r\n\r\n    if (typeof style === 'function') {\r\n      style = style(layer.feature);\r\n    }\r\n    if (layer.setStyle) {\r\n      layer.setStyle(style);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Utility Methods\r\n   */\r\n\r\n  eachFeature: function (fn, context) {\r\n    for (var i in this._layers) {\r\n      fn.call(context, this._layers[i]);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  getFeature: function (id) {\r\n    return this._layers[id];\r\n  }\r\n});\r\n\r\nexport function featureLayer (options) {\r\n  return new FeatureLayer(options);\r\n}\r\n\r\nexport default featureLayer;\r\n"],"names":["featureLayer","options","FeatureLayer","FeatureManager","extend","statics","EVENTS","CLUSTEREVENTS","initialize","prototype","call","this","L","setOptions","_layers","_leafletIds","cluster","markerClusterGroup","_key","Math","random","toString","replace","addEventParent","onAdd","map","_map","addLayer","onRemove","removeLayer","createLayers","features","markers","i","length","geojson","layer","id","GeoJSON","geometryToLayer","feature","asFeature","defaultOptions","_leaflet_id","resetStyle","onEachFeature","fire","timeField","_featureWithinTimeRange","push","addLayers","ids","layersToAdd","removeLayers","permanent","layersToRemove","setFeatureStyle","style","setStyle","eachFeature","fn","context","getFeature"],"mappings":"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"}